# Filter High Frequency Traders from ApexLiquid

## 项目概述

这是一个用于分析和过滤 Hyperliquid 交易平台上高频交易者的 Python 工具。该项目通过分析用户的交易记录，计算平均持仓时间，识别出可能的高频交易者，并提供了黑名单功能来过滤已知的高频交易者。

---

## 依赖该项目：

https://github.com/zhajingwen/calculate-average-hold-time-for-for-hyperliquid-user

---

## 功能特性

### 核心功能
- **交易数据分析**: 从 Hyperliquid API 获取用户的完整交易记录
- **持仓时间计算**: 使用 FIFO（先进先出）算法计算每个币种的平均持仓时间
- **高频交易者识别**: 基于持仓时间阈值识别潜在的高频交易者
- **黑名单过滤**: 支持预先定义的黑名单来排除已知的高频交易者
- **多交易类型支持**: 同时支持合约交易和现货交易的分析

### 分析维度
- **合约交易**: 分析永续合约的持仓模式
- **现货交易**: 分析现货买卖的持仓模式
- **综合统计**: 提供合约和现货的综合对比分析
- **详细指标**: 包括简单平均、加权平均、最短/最长持仓时间等

## 项目结构

```
filter-high-frequency-traders-from-from-apexliquid/
├── main.py                           # 主程序入口
├── pyproject.toml                    # 项目配置文件
├── README.md                         # 项目说明文档
├── utils/
│   ├── __init__.py                   # 工具包初始化
│   ├── config.py                     # 配置文件（包含交易者数据）
│   ├── average_holding_time.py       # 持仓时间分析器
│   └── blacklist.txt                 # 黑名单文件
└── filter_high_frequency_traders_from_from_apexliquid.egg-info/
    ├── dependency_links.txt
    ├── PKG-INFO
    ├── requires.txt
    └── SOURCES.txt
```

## 安装和配置

### 环境要求
- Python >= 3.13
- requests >= 2.32.5

### 安装依赖
```bash
pip install -r requirements.txt
# 或者使用 uv
uv pip install -r requirements.txt
```

### 配置说明
1. **黑名单配置**: 在 `utils/blacklist.txt` 中添加需要过滤的地址
2. **交易者数据**: 在 `utils/config.py` 中更新 `address_list` 数据
3. **分析阈值**: 在 `utils/average_holding_time.py` 中调整持仓时间阈值

## 使用方法

### 基本使用
```bash
python main.py
```

### 程序流程
1. 从配置文件加载交易者地址列表
2. 读取黑名单文件
3. 遍历每个交易者地址：
   - 检查是否在黑名单中
   - 获取交易记录
   - 计算平均持仓时间
   - 判断是否为高频交易者
4. 输出识别出的高频交易者列表

### 分析器使用示例
```python
from utils.average_holding_time import AverageHoldingTimeAnalyzer

# 创建分析器
analyzer = AverageHoldingTimeAnalyzer("0x1234...")

# 执行分析
result = analyzer.analyze()

# 获取统计数据
stats = analyzer.get_overall_statistics()
```

## 核心类和功能

### AverageHoldingTimeAnalyzer 类

#### 主要方法
- `fetch_user_fills()`: 从 Hyperliquid API 获取用户交易记录
- `calculate_average_holding_time()`: 计算平均持仓时间
- `get_coin_statistics(coin, is_spot)`: 获取指定币种的统计数据
- `get_overall_statistics(is_spot)`: 获取总体统计数据
- `print_statistics()`: 打印完整的统计报告
- `analyze()`: 执行完整的分析流程

#### 数据存储
- `perp_holding_times`: 合约持仓时间数据
- `spot_holding_times`: 现货持仓时间数据
- `perp_positions`: 合约未平仓位
- `spot_positions`: 现货未平仓位

### 分析算法

#### 持仓时间计算
1. **FIFO 算法**: 使用先进先出原则处理开仓和平仓
2. **时间追踪**: 记录每笔交易的开仓和平仓时间
3. **权重计算**: 支持按仓位大小的加权平均计算

#### 高频交易识别
- **阈值判断**: 当平均持仓时间超过 1 小时时，认为不是高频交易者
- **多维度分析**: 同时考虑合约和现货交易模式
- **统计指标**: 提供多种统计指标用于判断

## 配置说明

### 黑名单文件 (blacklist.txt)
```
0xf88a2d2815f49f7963bf2481a231ca251d7cfb1f
0x428705129cc113583338aeb60b4273ced6284a3c
0x1394affc8585d19463f20eea26af9ee52cedce55
...
```

### 交易者数据格式
```json
{
    "code": 0,
    "message": "success",
    "data": {
        "trades": [
            {
                "address": "0x...",
                "perpsBalance": "61876.190498",
                "tradeAge": "1749676920183",
                "dayRoe": "38.33",
                "weekRoe": "74.7",
                "monthRoe": "164.82",
                "allTimeRoe": "185.73",
                "maxDrawdown": "77.45",
                "directionBias": "-90",
                "lastTrade": "1760397434493",
                "winRate": "65",
                "allPnl": "28642.620498",
                "dayPnl": "-13618.687713",
                "weekPnl": "-22091.339493",
                "monthPnl": "-23967.680482",
                "favorite": false
            }
        ]
    }
}
```

## API 接口

### Hyperliquid API
- **端点**: `https://api.hyperliquid.xyz/info`
- **方法**: POST
- **功能**: 获取用户交易记录
- **参数**: 用户地址、聚合时间等

### 请求格式
```json
{
    "aggregateByTime": true,
    "type": "userFills",
    "user": "0x1234..."
}
```

## 输出示例

### 控制台输出
```
正在获取用户 0x1234... 的交易记录...

成功获取 150 条交易记录

其中: 合约交易 120 条, 现货交易 30 条

================================================================================
Hyperliquid 交易分析报告
================================================================================

【合约】持仓时间统计报告
================================================================================
【BTC】持仓时间统计报告
--------------------------------------------------------------------------------
  平仓次数: 25
  简单平均持仓时间: 2.5 小时
  加权平均持仓时间: 2.8 小时 (按仓位大小加权)
  最短持仓时间: 0.2 小时
  最长持仓时间: 8.5 小时
  总平仓量: 12.5000

【现货】持仓时间统计报告
================================================================================
【ETH】持仓时间统计报告
--------------------------------------------------------------------------------
  平仓次数: 10
  简单平均持仓时间: 1.2 小时
  加权平均持仓时间: 1.5 小时 (按仓位大小加权)
  最短持仓时间: 0.1 小时
  最长持仓时间: 3.2 小时
  总平仓量: 5.2000

================================================================================
【综合对比】
================================================================================

合约交易:
  总平仓次数: 25
  简单平均持仓时间: 2.5 小时
  加权平均持仓时间: 2.8 小时

现货交易:
  总平仓次数: 10
  简单平均持仓时间: 1.2 小时
  加权平均持仓时间: 1.5 小时

所有交易（合约+现货）:
  总平仓次数: 35
  简单平均持仓时间: 2.1 小时
  加权平均持仓时间: 2.4 小时
```

### 高频交易者列表
```
['0x1234...', '0x5678...', '0x9abc...']
```

## 扩展功能

### 自定义分析
- 可以修改持仓时间阈值
- 支持添加新的统计指标
- 可以扩展黑名单逻辑

### 数据导出
- 支持将分析结果导出为 JSON/CSV 格式
- 可以生成详细的分析报告

### 批量处理
- 支持批量分析多个地址
- 可以设置并发处理以提高效率

## 注意事项

1. **API 限制**: 注意 Hyperliquid API 的调用频率限制
2. **数据准确性**: 持仓时间计算基于交易记录，确保数据完整性
3. **黑名单维护**: 定期更新黑名单以确保过滤效果
4. **阈值调整**: 根据实际需求调整高频交易的判断阈值

## 技术栈

- **Python 3.13+**: 主要编程语言
- **requests**: HTTP 客户端库
- **json**: JSON 数据处理
- **datetime**: 时间处理
- **collections**: 数据结构支持

## 贡献指南

1. Fork 项目
2. 创建功能分支
3. 提交更改
4. 创建 Pull Request

## 许可证

请查看项目根目录下的许可证文件。

## 联系方式

如有问题或建议，请通过以下方式联系：
- 提交 Issue
- 发送邮件
- 创建 Pull Request
